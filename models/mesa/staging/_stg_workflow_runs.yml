version: 2
models:
  - name: stg_workflow_runs
    description: A intermediate model that isolates the very first step executed of each workflow run.
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 10000
    columns:
      - name: workflow_run_id
        tests:
          - not_null
      - name: is_billable
        description: A step/workflow is only billed once -- not for each step. So only true for the first trigger.
        tests:
          - not_null
      - name: shop_subdomain
        tests:
          - not_null
          - relationships:
              to: ref('stg_shops')
              field: shop_subdomain
      - name: run_status
        test:
          - not_null

###########################################
### Roll-up Models #########################
###########################################

      - name: WORKFLOW_ID
        tests:
          - not_null
      - name: workflow_RUN_AT_UTC
        tests:
          - not_null
      - name: workflow_RUN_AT_PT
        tests:
          - not_null
      - name: workflow_RUN_ON_PT
        tests:
          - not_null
      - name: UNBILLABLE_REASON
      - name: SOURCE_APP
      - name: UPDATED_AT
        tests:
          - not_null
      - name: is_workflow_hard_deleted
        tests:
          - not_null
      - name: CHILD_FAILURE_COUNT
      - name: IS_FREE_WORKFLOW
      - name: INTEGRATION_KEY
      - name: WORKFLOW_NAME

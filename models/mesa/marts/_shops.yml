version: 2
models:
  - name: shops
    description: formatted, production-ready shops.
    meta:
      metabase.caveats:
        this table combines all the install records of `m3_mesa` into
        one shop record.
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 4000
    columns:
      - name: shop_subdomain
        tests:
          - not_null
          - unique
        description: The foreign key for the Shop.
      - name: first_installed_at_pt
        tests:
          - not_null
        description: The effective created at for the shop.
      - name: currency
        tests:
          - not_null
        description: The financial currency used by the shop with its customers.
      - name: unique_workflows_successfully_run_count
        tests:
          - not_null
        description: The number of workflow runs that have completed without error.
      - name: shopify_plan_name
        description: The shopify plan used by the shop.
      - name: install_status
        description: The current mesa app installation status of the shop.
      - name: status
        description: The usage status of the shop.
      - name: referral
        description: "[fill]"
      - name: meta
        description: a field used by account services to record onboarding sessions.
      - name: latest_installed_at_pt
        description: The most recent app installation date.
      - name: billing_method_name
        description: The method used to charge the shop for their subscription & usage.
      - name: billing_overage_bucket_start_date_pt
        description: "[fill]"
      - name: billing_overage_bucket_end_date_pt
        description: "[fill]"
      - name: billing_overage_bypass_until
        description: "[fill]"
      - name: billing_overage_last_count
        description: "[fill]"
      - name: daily_plan_revenue
        description: The amount of revenue from plan charges for this day.
      - name: price_per_action
        description: "[fill]"
      - name: activation_date_pt
        description: The date the shop achieved the current definition of activated.
      - name: is_activated
        description: whether the shop has achieved activation.
      - name: templates_installed_count
        description: The number of templates the shop has installed as a workflow.
      - name: balance_used
        description: "[fill]"
      - name: shopify_id
        description: The official shopify identifier for the shop.
      - name: plan_price
        description: The current mesa plan's monthly cost.
      - name: plan_used
        description: "[fill]"
      - name: percent_complete
        description: "[fill]"
      - name: billing_on_pt
        description: "[fill]"
      - name: plan_name
        description: The mesa plan the shop is currently subscribed to.
      - name: percent_used
        description: "[fill]"
      - name: overlimit_date_pt
        description: "[fill]"
      - name: balance_remaining
        description: "[fill]"
      - name: start_date_pt
        description: "[fill]"
      - name: end_date_pt
        description: "[fill]"
      - name: shopify_shop_gmv_initial_total_usd
        description: The 30-day gmv of the shop at the time of installation.
        meta:
          metabase.semantic_type: type/Currency
          metabase.display_name: initial revenue / gmv
      - name: trial_ends_pt
        description: The date the initial billing trial period ends.
        meta:
          metabase.display_name: Trial End Date (PT)
      - name: chargebee_id
        description: The id of the chargebee account if used for billing.
      - name: billing_updated_at_pt
        description: The timestamp the billing information was updated at in pt.
        meta:
          metabase.display_name: Billing Updated At (PT)
      - name: plan_type
        description: "[fill]"
      - name: days_complete
        description: "[fill]"
      - name: plan_id
        description: The code-friendly shortcode of the current mesa plan.
        meta:
          metabase.display_name: Plan Identifier
      - name: shopify_shop_gmv_current_total_usd
        description: The current 30-day GMV of the Shopify Shop.
        meta:
          metabase.display_name: Current Shop Revenue / GMV
          metabase.semantic_type: type/Currency
      - name: plan_interval
        description: The frequency of the billing plan interval.
      - name: trial_days
        description: The initial length of the trial period.
      - name: is_builder_wizard_completed
        description: "[fill]"
      - name: hotjar_url
        description: a direct link to the user's hotjar sessions.
      - name: backdoor_url
        description: a direct link to the Shop's backdoor ui.
      - name: minutes_using_app
        description:
          The total minutes between the first and last pageview inside the
          app.
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.7
              config:
                where: first_installed_at_pt > '2020-12-18'
      - name: workflow_runs_attempted_count
        description: The number of Workflow Run attempts that have been started.
        tests:
          - not_null
      - name: last_seen_in_app_at_pt
        description: The timestamp of the last pageview inside the pap.
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.7
      - name: workflow_run_success_count
        description: The number of Workflow Run attempts that have completed successfully.
        tests:
          - not_null
      - name: minutes_until_uninstall
        description: The minutes between initial install and the latest uninstall.
      - name: first_seen_in_app_at_pt
        description: The timestamp of the first pageview within the app.
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.7
      - name: workflow_run_success_rolling_thirty_day_count
        description:
          The number of successful workflow run attempts initiated in the last
          30 days as of this day.
        tests:
          - not_null
      - name: days_to_activation
        description: The number of days from first install to activation.
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.02
      - name: workflow_run_success_rolling_year_count
        description:
          The number of successful workflow run attempts initiated in the last
          year as of this day.
      - name: uninstalled_at_pt
        description: The timestamp of the latest uninstallation of the app.
      - name: first_plan_upgrade_date
        description: The date of the first plan upgrade action.
      - name: acquisition_campaign
        description: The campaign that the shop was acquired through.
      - name: acquisition_content
        description: The content that the shop was acquired through.
      - name: acquisition_first_page_path
        description: The first page path that the shop was acquired through.
      - name: acquisition_referrer
        description: The referrer that the shop was acquired through.
      - name: acquisition_medium
        description: The medium that the shop was acquired through.
      - name: acquisition_source
        description: The source that the shop was acquired through.
      - name: acquisition_source_medium
        description: The source & medium that the shop was acquired through.
      - name: funnel_phase
        description: The top-level step in the funnel that the shop is currently in.
        tests:
          - not_null
      - name: has_a_workflow
        description: whether the shop has ever created a workflow or installed a template.
        tests:
          - not_null
      - name: max_funnel_step_achieved_at_pt
        description: The timestamp of the latest funnel step achieved in pt.
        tests:
          - not_null
      - name: has_enabled_a_workflow
        description: whether the shop has ever enabled a workflow.
        tests:
          - not_null
      - name: cohort_week
        description: The week of the Shop's first app installation.
        tests:
          - not_null
      - name: max_funnel_step
        description: The numeric value of latest funnel step achieved.
        tests:
          - not_null
      - name: max_funnel_step_name
        description: The name of the latest funnel step achieved.
        tests:
          - not_null
      - name: cohort_month
        description: The month of the Shop's first app installation.
        tests:
          - not_null
      - name: total_ltv_revenue
        description:
          The total revenue generated by users who first installed in the given
          week.
        tests:
          - not_null
        meta:
          metabase.display_name: Total LTV Revenue
          metabase.semantic_type: type/Currency
      - name: workflows_enabled_current_count
        description: The number of currently enabled workflows for the shop.
        tests:
          - not_null
      - name: workflows_current_count
        description:
          The number of total workflows currently created on the shop (enabled
          or disabled).
        tests:
          - not_null
      - name: trial_end_dt
        description: The date the Shop's trial ended.
        meta:
          metabase.display_name: Trial End Date (UTC)
      - name: launch_session_date
        description: The date of the launch session with customer success.
      - name: days_from_launch_session_to_activation
        description: The number of days from launch to activation. (may be negative.)
        meta:
          metabase.caveats:
            this number may be negative if they activated before the launch
            session.
      - name: has_had_launch_session
        description: whether the shop has had a launch session with customer success.
        tests:
          - not_null
      - name: shopify_shop_gmv_current_total_tier
        description: The tier of the Shop's current revenue.
        meta:
          metabase.display_name: current revenue tier/bucket
      - name: has_uploadery
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_tracktor
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_blog_studio
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_kitkarts
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_smile
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_bouncer
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_page_studio
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_coin
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: has_infinite_options
        description: whether the shop has an account for this app.
        tests:
          - not_null
      - name: acquisition_template
        description:
          The template the Shop intended to use when they first installed the
          app.
      - name: is_blog_referral
        description:
          Whether the Shop was referred/entered the marketing site by a blog
          post.
        tests:
          - not_null
      - name: unique_workflows_attempted_count
        description: The number of workflow attempts that have been started.
        tests:
          - not_null
      - name: shopify_shop_orders_initial_count
        description: The number of orders the Shop had at the time of install.
      - name: age_of_store_at_install_bucket
        description: The bucket of the Shop's age at install.
      - name: age_of_store_at_install_in_days
        description: The age (in days) of the store at the initial install.
      - name: shopify_shop_created_at_pt
        description: The timestamp of the Shopify Shop's creation.
      - name: shopify_shop_orders_current_count
        description: The last-30-day order volume of the Shop.
      - name: age_of_store_at_install_in_weeks
        description: The age (in weeks) of the store at the initial install.
      - name: store_leads_category
        description:
          The first full category/sub-category group of the Shop pulled in
          from Store Leads.
        meta:
          metabase.display_name: Shopify Shop Product Category & Subcategory (Store Leads)
      - name: store_leads_top_level_category
        description: The first top-level category of the Shop pulled in from Store Leads.
        meta:
          metabase.display_name: Shopify Shop Product Top-Level Category (Store Leads)
      - name: store_leads_features
        description: A list of the Shop features pulled in from Store Leads.
        meta:
          metabase.display_name: Shopify Shop Features (Store Leads)
      - name: store_leads_has_recharge
        description:
          Indicates whether the Shop has Recharge listed in their Store Leads
          features.
        meta:
          metabase.display_name: Has Recharge? (Store Leads)
      - name: store_leads_platform_rank
        description:
          The rank of the Shop on the platform (Shopify) pulled in from Store
          Leads.
        meta:
          metabase.display_name: Shopify Store Rank (Store Leads)
      - name: store_leads_platform_rank_percentile
        description: The percentile of the Shop's rank pulled in from Store Leads.
        meta:
          metabase.display_name: Shopify Store Rank Percentile (Store Leads)
      - name: store_leads_estimated_monthly_sales
        description: The estimated monthly sales pulled in from Store Leads.
        meta:
          metabase.semantic_type: type/Currency
          metabase.display_name: Estimated Shop Sales (Store Leads)
      - name: store_leads_monthly_app_spend
        description:
          The estimated amount the Shop spends on Shopify apps (pulled in from
          Store Leads).†≤
        meta:
          metabase.semantic_type: type/Currency
          metabase.display_name: Monthly App Spend (Store Leads)
      - name: shopify_shop_country
        description: The country of the Shop provided by the Shopify API.
      - name: store_leads_estimated_monthly_sales_bucket
        description:
          The bucket of the Shop's estimated monthly sales pulled in from Store
          Leads.
        meta:
          metabase.display_name: Estimated Monthly Sales Bucket (Store Leads)
      - name: income_rolling_thirty_day_total
        description:
          The ShopPad revenue attributed to the Shop from Mesa in the last
          30 days.
        meta:
          metabase.semantic_type: type/Currency
          metabase.display_name: Last 30-Day Income
      - name: income_rolling_year_total
        description:
          The ShopPad revenue attributed to the Shop from Mesa in the last
          year.
        meta:
          metabase.semantic_type: type/Currency
          metabase.display_name: Last Year Income
      - name: is_custom_app
        description:
          Whether the Shop is a custom application with custom pricing not
          billed through the Shopify system.
        tests:
          - not_null
      - name: shopify_shop_gmv_initial_cohort_avg_percent
        description:
          The percent comparison of the Shop's initial revenue compared to
          its cohort.
        meta:
          metabase.display_name: Shopify Shop GMV Compared to Cohort Avg (Install)
      - name: shopify_shop_gmv_current_cohort_avg_percent
        description:
          The percent comparison of the Shop's current revenue compared to
          all other Shops.
        meta:
          metabase.display_name: Shopify Shop GMV Compared to All Avg (Current)
      - name: latest_installed_at_utc
        description: The timestamp of the Shop's latest install in UTC.
      - name: first_installed_at_utc
        description: The timestamp of the Shop's first install in UTC.
      - name: is_mql
        description: Whether the Shop is an MQL.
        meta:
          metabase.display_name: Is MQL?
      - name: initial_shopify_plan_name
        description: The name of the Shop's initial Shopify plan.
      - name: first_installed_on_pt
        description: The date of the Shop's first install.
        meta:
          metabase.display_name: First Installed On (PT)
      - name: last_broadcast_email_open_at_pt
        description: The timestamp of the Shop's last broadcast email open
      - name: broadcast_email_opens_count
        description: The number of broadcast email opens for the Shop.
      - name: has_opened_broadcast_email
        description: Whether the Shop has opened a Broadcast email.
      - name: first_broadcast_email_open_at_pt
        description: The timestamp of the Shop's first email open.
      - name: first_broadcast_email_clicked_at_pt
        description: The timestamp of the Shop's first broadcast email click.
      - name: first_broadcast_email_converted_at_pt
        description: The timestamp of the Shop's first broadcast email conversion.
      - name: last_broadcast_email_clicked_at_pt
        description: The timestamp of the Shop's last broadcast email click.
      - name: broadcast_email_click_count
        description: The number of Broadcast email clicks for the Shop.
      - name: broadcast_email_conversion_count
        description: The number of email conversions for the Shop.
      - name: has_clicked_broadcast_email
        description: Whether the Shop has clicked a broadcast email.
      - name: last_broadcast_email_converted_at_pt
        description: The timestamp of the Shop's last broadcast email conversion.
      - name: first_in_constellation_at_utc
        description: The timestamp of the Shop's first install in the constellation.
      - name: first_in_constellation_on_pt
        description: The date of the Shop's first install in the constellation apart from MESA.
        meta:
          metabase.display_name: First In Constellation On (PT)
      - name: first_in_constellation_at_pt
        description: The timestamp of the Shop's first install in the constellation apart from MESA.
        meta:
          metabase.display_name: First In Constellation At (PT)
      - name: constellation_cohort_week
        description: The week of the Shop's first install in the constellation apart from MESA.
        meta:
          metabase.display_name: Constellation Cohort Week
      - name: last_journey_email_converted_at_pt
        description: The timestamp of the Shop's last journey email conversion.
      - name: has_converted_via_broadcast_email
        description: Whether the Shop has converted via broadcast email.
      - name: journey_email_opens_count
        description: The number of journey email opens for the Shop.
      - name: first_journey_email_converted_at_pt
        description: The timestamp of the Shop's first journey email conversion.
      - name: has_converted_via_journey_email
        description: Whether the Shop has converted via journey email.
      - name: journey_email_conversion_count
        description: The number of journey email conversions for the Shop.
      - name: last_journey_email_clicked_at_pt
        description: The timestamp of the Shop's last journey email click.
      - name: last_journey_email_open_at_pt
        description: The timestamp of the Shop's last journey email open.
      - name: first_journey_email_clicked_at_pt
        description: The timestamp of the Shop's first journey email click.
      - name: journey_email_click_count
        description: The number of journey email clicks for the Shop.
      - name: has_clicked_journey_email
        description: Whether the Shop has clicked a journey email.
      - name: first_journey_email_open_at_pt
        description: The timestamp of the Shop's first journey email open.
      - name: has_opened_journey_email
        description: Whether the Shop has opened a journey email.
      - name: is_in_trial
        description: Whether the Shop is in a trial.
        meta:
          metabase.display_name: Is In Trial?
        tests:
          - not_null
      - name: ever_upgraded_to_paid_plan
        description: Whether the Shop has ever upgraded to a paid plan.
        meta:
          metabase.display_name: Ever Upgraded to Paid Plan?
        tests:
          - not_null
      - name: first_plan_identifier
        description: The identifier of the Shop's first plan.
      - name: days_until_first_plan_upgrade
        description: The number of days until the Shop's first plan upgrade.
        meta:
          metabase.display_name: Days Until First Plan Upgrade
      - name: last_plan_upgrade_date
        description: The date of the Shop's last plan upgrade.
        meta:
          metabase.display_name: Last Plan Upgrade Date
      - name: last_plan_identifier
        description: The identifier of the Shop's latest MESA plan.
        meta:
          metabase.display_name: Latest Plan Identifier
      - name: is_currently_paying
        description: Whether the Shop is currently paying for a plan.
        meta:
          metabase.display_name: Is Currently Paying?
        tests:
          - not_null
      - name: currency_not_supported
        description: Whether the Shop's currency is not supported in the DBT/Snowflake currency conversion data.
        meta:
          metabase.display_name: Currency Not Supported?
        tests:
          - not_null
      - name: is_zombie_shopify_plan
        description: Whether the Shop is on a zombie Shopify plan.
        meta:
          metabase.display_name: Is Zombie Shopify Plan?
        tests:
          - not_null
      - name: workflow_run_attempt_rolling_year_count
        description:
          The number of successful workflow run attempts initiated in the last
          year as of this day.
      - name: average_daily_usage_revenue
        description: The average daily usage revenue for the Shop (calculated by the average of the last 30 billable days).
      - name: workflow_run_attempt_rolling_thirty_day_count
        description:
          The number of successful workflow run attempts initiated in the last
          30 days as of this day.
      - name: input_step_rolling_thirty_day_count
        description: The total number of Workflow Steps started in the last 30 days as of Yesterday.
        tests:
          - not_null
      - name: output_step_rolling_thirty_day_count
        description: The total number of "input" (Trigge) Workflow Steps completed in the last 30 days as of Yesterday.
        tests:
          - not_null
      - name: total_workflow_steps_rolling_thirty_day_count
        description: The total number of Workflow Steps completed in the last 30 days as of Yesterday.
        tests:
          - not_null
      - name: first_workflow_trigger_key
        description: The key of the first step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: total_thirty_day_revenue
        description: The total revenue for the Shop in the last 30 days as of Yesterday.
        tests:
          - not_null
      - name: first_workflow_trigger_app
        description: The app of the first step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_destination_key
        description: The key of the last step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_destination_app
        description: The app of the last step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_destination_name
        description: The name of the last step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: average_daily_revenue
        description: The average daily revenue for the Shop (calculated by the average of the last 30 billable days).
      - name: first_workflow_trigger_name
        description: The name of the first step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: integration_apps_enabled_count
        description: The number of unique integration apps enabled for the Shop.
        tests:
          - not_null
      - name: pro_apps_enabled_count
        description: The number of unique pro apps enabled in workflows for the Shop.
        tests:
          - not_null
      - name: first_workflow_sort_title
        description: The sort title of the first workflow in the Shop. (Cleaned title or marked as DELETED.)
      - name: trigger_destination_app_pair
        description: The app pair of the Shop's first workflow. Gives a clue to their MESA use case.
      - name: trigger_destination_key_pair
        description: The key pair of the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_destination_name
        description: The name of the last step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_destination_key
        description: The key of the last step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_trigger_name
        description: The name of the first step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: max_workflow_steps
        description: The maximum number of steps in any workflow for the Shop.
        tests:
          - not_null
      - name: first_workflow_title
        description: The title of the Shop's first workflow. Gives a clue to their MESA use case.
      - name: is_using_pro_apps
        description: Whether the Shop is using any pro apps.
        tests:
          - not_null
      - name: first_workflow_trigger_key
        description: The key of the first step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_destination_app
        description: The app of the last step in the Shop's first workflow. Gives a clue to their MESA use case.
      - name: trigger_destination_name_pair
        description: The name pair of the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_app_chain
        description: The app chain of the Shop's first workflow. Gives a clue to their MESA use case.
      - name: first_workflow_step_chain
        description: The step chain of the Shop's first workflow. Gives a clue to their MESA use case.

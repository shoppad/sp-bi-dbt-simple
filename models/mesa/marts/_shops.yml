version: 2
models:
  - name: shops
    description: Formatted, production-ready shops with workflow and billing information.
    meta:
      metabase.caveats: This table combines all the install records of m3_mesa into one shop record.
    data_tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 4000
    columns:
      - name: shop_subdomain
        description: The foreign key for the Shop.
      - name: first_installed_at_pt
        description: The effective created at for the shop.
        data_tests:
          - not_null
      - name: currency
        description: The financial currency used by the shop with its customers.
        data_tests:
          - not_null
      - name: shopify_plan_name
        description: The Shopify plan used by the shop.
      - name: install_status
        description: The current mesa app installation status of the shop.
      - name: meta
        description: A field used by account services to record onboarding sessions.
      - name: latest_installed_at_pt
        description: The most recent app installation date.
      - name: billing_method_name
        description: The method used to charge the shop for their subscription & usage.
      - name: price_per_action
        description: The price per action for the shop.
      - name: activation_date_pt
        description: The date the shop achieved the current definition of activated.
      - name: is_activated
        description: Whether the shop has achieved activation.
      - name: templates_installed_count
        description: The number of templates the shop has installed as a workflow.
      - name: shopify_id
        description: The official Shopify identifier for the shop.
      - name: plan_price
        description: The current mesa plan's monthly cost.
      - name: plan_name
        description: The mesa plan the shop is currently subscribed to.
      - name: shopify_shop_gmv_initial_total_usd
        description: The 30-day GMV of the shop at the time of installation.
        meta:
          metabase.display_name: Initial Revenue / GMV
          metabase.semantic_type: type/Currency
      - name: trial_ends_pt
        description: The date the initial billing trial period ends.
        meta:
          metabase.display_name: Trial End Date (PT)
      - name: plan_id
        description: The code-friendly shortcode of the current mesa plan.
        meta:
          metabase.display_name: Plan Identifier
      - name: shopify_shop_gmv_current_total_usd
        description: The current 30-day GMV of the Shopify Shop.
        meta:
          metabase.display_name: Current Shop Revenue / GMV
          metabase.semantic_type: type/Currency
      - name: plan_interval
        description: The frequency of the billing plan interval.
      - name: trial_days
        description: The initial length of the trial period.
      - name: is_builder_wizard_completed
        description: Whether the builder wizard was completed.
      - name: hotjar_url
        description: A direct link to the user's Hotjar sessions.
      - name: backdoor_url
        description: A direct link to the Shop's backdoor UI.
      - name: uninstalled_at_pt
        description: The timestamp of the latest uninstallation of the app.
      - name: funnel_phase
        description: The funnel phase the Shop is in (activated or onboarding).
        data_tests:
          - not_null
      - name: has_a_workflow
        description: Whether the shop has ever created a workflow or installed a template.
        data_tests:
          - not_null
      - name: max_funnel_step_achieved_at_pt
        description: The timestamp of the latest funnel step achieved in PT.
        data_tests:
          - not_null
      - name: has_enabled_a_workflow
        description: Whether the shop has ever enabled a workflow.
        data_tests:
          - not_null
      - name: cohort_week
        description: The week of the Shop's first app installation.
        data_tests:
          - not_null
      - name: max_funnel_step
        description: The numeric value of latest funnel step achieved.
        data_tests:
          - not_null
      - name: max_funnel_step_name
        description: The name of the latest funnel step achieved.
        data_tests:
          - not_null
      - name: cohort_month
        description: The month of the Shop's first app installation.
        data_tests:
          - not_null
      - name: workflows_enabled_current_count
        description: The number of currently enabled workflows for the shop.
        data_tests:
          - not_null
      - name: workflows_current_count
        description: The number of total workflows currently created on the shop (enabled or disabled).
        data_tests:
          - not_null
      - name: launch_session_date
        description: The date of the launch session with customer success.
      - name: days_from_launch_session_to_activation
        description: The number of days from launch to activation. (may be negative.)
        meta:
          metabase.caveats: This number may be negative if they activated before the launch session.
      - name: has_had_launch_session
        description: Whether the shop has had a launch session with customer success.
      - name: shopify_shop_gmv_current_total_tier
        description: The tier of the Shop's current revenue.
        meta:
          metabase.display_name: Current Revenue Tier/Bucket
      - name: shopify_shop_orders_initial_count
        description: The 30-day order count volume at the time of app installation.
      - name: age_of_store_at_install_bucket
        description: The bucket of the Shop's age at install.
      - name: age_of_store_at_install_in_days
        description: The age (in days) of the store at the initial install.
      - name: shopify_shop_created_at_pt
        description: The timestamp of the Shopify Shop's creation.
      - name: shopify_shop_orders_current_count
        description: The current monthly order volume of the shop.
      - name: age_of_store_at_install_in_weeks
        description: The age (in weeks) of the store at the initial install.
      - name: shopify_shop_country
        description: The country of the Shop provided by the Shopify API.
      - name: is_custom_app
        description: Whether the Shop is a custom application with custom pricing not billed through the Shopify system.
        data_tests:
          - not_null
      - name: shopify_shop_gmv_initial_cohort_avg_percent
        description: The percent comparison of the Shop's initial revenue compared to its cohort.
        meta:
          metabase.display_name: Shopify Shop GMV Compared to Cohort Avg (Install)
      - name: shopify_shop_gmv_current_cohort_avg_percent
        description: The percent comparison of the Shop's current revenue compared to all other Shops.
        meta:
          metabase.display_name: Shopify Shop GMV Compared to All Avg (Current)
      - name: latest_installed_at_utc
        description: The timestamp of the Shop's latest install in UTC.
      - name: first_installed_at_utc
        description: The timestamp of the Shop's first install in UTC.
      - name: is_mql
        description: Whether the Shop is an MQL.
        meta:
          metabase.display_name: Is MQL?
      - name: initial_shopify_plan_name
        description: The name of the Shop's initial Shopify plan.
      - name: first_installed_on_pt
        description: The date of the Shop's first install.
        meta:
          metabase.display_name: First Installed On (PT)
      - name: is_in_trial
        description: Whether the Shop is in a trial.
        meta:
          metabase.display_name: Is In Trial?
        data_tests:
          - not_null
      - name: currency_not_supported
        description: Whether the Shop's currency is not supported in the DBT/Snowflake currency conversion data.
        meta:
          metabase.display_name: Currency Not Supported?
        data_tests:
          - not_null
      - name: is_shopify_zombie_plan
        description: Indicates whether the store is on a 'frozen', 'fraudulent', 'paused', 'dormant' or 'cancelled' Shopify plan.
        meta:
          metabase.display_name: Is Zombie Shopify Plan?
        data_tests:
          - not_null
      - name: first_workflow_trigger_key
        description: The key of the first step in the Shop's first workflow.
      - name: first_workflow_trigger_app
        description: The app of the first step in the Shop's first workflow.
      - name: first_workflow_destination_key
        description: The key of the last step in the Shop's first workflow.
      - name: first_workflow_destination_app
        description: The app of the last step in the Shop's first workflow.
      - name: first_workflow_destination_name
        description: The name of the last step in the Shop's first workflow.
      - name: first_workflow_trigger_name
        description: The name of the first step in the Shop's first workflow.
      - name: integration_apps_enabled_count
        description: The number of unique integration apps enabled for the Shop.
        data_tests:
          - not_null
      - name: pro_apps_enabled_count
        description: The number of unique pro apps enabled in workflows for the Shop.
        data_tests:
          - not_null
      - name: first_workflow_sort_title
        description: The sort title of the first workflow in the Shop.
      - name: first_workflow_trigger_destination_app_pair
        description: The app pair of the Shop's first workflow.
      - name: first_workflow_trigger_destination_key_pair
        description: The key pair of the Shop's first workflow.
      - name: max_workflow_steps
        description: The maximum number of steps in any workflow for the Shop.
        data_tests:
          - not_null
      - name: first_workflow_title
        description: The title of the Shop's first workflow.
      - name: is_using_pro_apps
        description: Whether the Shop is using any pro apps.
        data_tests:
          - not_null
      - name: first_workflow_trigger_destination_name_pair
        description: The name pair of the Shop's first workflow.
      - name: first_workflow_app_chain
        description: The app chain of the Shop's first workflow.
      - name: first_workflow_step_chain
        description: The step chain of the Shop's first workflow.
      - name: first_workflow_id
        description: The ID of the Shop's first workflow.
      - name: has_ever_installed_coin
        description: Whether the Shop has ever installed Coin.
      - name: has_shoppad_constellation_app
        description: Whether the Shop has ever installed any Shoppad Constellation app.
      - name: has_ever_installed_infinite_options
        description: Whether the Shop has ever installed Infinite Options.
      - name: has_ever_installed_kitkarts
        description: Whether the Shop has ever installed Kit Karts.
      - name: has_ever_installed_smile
        description: Whether the Shop has ever installed Smile.
      - name: has_ever_installed_bouncer
        description: Whether the Shop has ever installed Bouncer.
      - name: has_ever_installed_tracktor
        description: Whether the Shop has ever installed Tracktor.
      - name: has_ever_installed_pagestudio
        description: Whether the Shop has ever installed Page Studio.
      - name: has_ever_installed_blogstudio
        description: Whether the Shop has ever installed Blog Studio.
      - name: did_install_another_shoppad_app_first
        description: Whether the Shop installed another Shoppad app before installing their first Shoppad Constellation app.
      - name: has_ever_installed_uploadery
        description: Whether the Shop has ever installed Uploadery.
      - name: first_shoppad_app_installed
        description: The first Shoppad app installed by the Shop.
      - name: virtual_plan
        description: The v10 plan the Shop's usage qualifies for.
        data_tests:
          - not_null
      - name: virtual_plan_pro_app_qualifier
        description: The qualifier for the Shop's virtual plan based on their pro app usage.
      - name: virtual_plan_step_qualifier
        description: The qualifier for the Shop's virtual plan based on their workflow step usage.
      - name: first_shoppad_app_installed_at_pt
        description: The date/time the Shop installed their first Shoppad app.
      - name: first_shoppad_app_installed_at_utc
        description: The date/time the Shop installed their first Shoppad app in UTC.
      - name: has_saved_a_workflow
        description: Whether the Shop has ever saved a workflow.
        data_tests:
          - not_null
      - name: max_workflow_steps_with_deleted
        description: The maximum number of steps in any workflow for the Shop, including deleted steps.
        data_tests:
          - not_null
      - name: analytics_currency
        description: The currency of the Shop's analytics.
      - name: is_pql
        description: Whether the Shop is a PQL.
        data_tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.9
      - name: apps_used
        description: The apps used by the Shop.
      - name: apps_used_without_glue
        description: The apps used by the Shop, excluding glue apps.
      - name: has_puc_workflow
        description: Whether the Shop has a workflow with a PUC step.
        data_tests:
          - not_null
      - name: source_destination_pairs_list
        description: A list of the Shop's source/destination app pairs from all workflows.
      - name: has_csm_support
        description: Whether the Shop has CSM support and exists in our Book-of-Business (BOB).
        data_tests:
          - not_null
      - name: shopify_last_updated_at_pt
        description: The timestamp of the last update to the shop in Pacific Time.
      - name: first_workflow_destination_operation_id
        description: The operation ID of the first workflow destination.
      - name: first_workflow_trigger_operation_id
        description: The operation ID of the first workflow trigger.
      - name: days_to_activation
        description: The number of days from first install to activation.
      - name: has_had_launch_session_final
        description: Whether the shop has had a launch session (final computed value).
      - name: has_contacted_support
        description: Whether the Shop has contacted support.
      - name: support_lastreplyat
        description: The timestamp of the Shop's last support reply.
      - name: app_store_reviewed_at_pt
        description: The timestamp of the Shop's review of MESA in the app store in Pacific Time.
      - name: app_store_review_requested_at_pt
        description: The timestamp of when we sent the Shop a request to review MESA in the app store in Pacific Time.
      - name: has_app_store_reviewed
        description: Whether the Shop has reviewed MESA in the app store.
      - name: has_uploadery
        description: Whether the shop has an account for Uploadery.
      - name: has_tracktor
        description: Whether the shop has an account for Tracktor.
      - name: has_blogstudio
        description: Whether the shop has an account for Blog Studio.
      - name: has_kitkarts
        description: Whether the shop has an account for Kit Karts.
      - name: has_smile
        description: Whether the shop has an account for Smile.
      - name: has_bouncer
        description: Whether the shop has an account for Bouncer.
      - name: has_pagestudio
        description: Whether the shop has an account for Page Studio.
      - name: has_coin
        description: Whether the shop has an account for Coin.
      - name: has_infinite_options
        description: Whether the shop has an account for Infinite Options.
      - name: first_in_constellation_at_utc
        description: The timestamp of the Shop's first install in the constellation.
      - name: first_in_constellation_on_pt
        description: The date of the Shop's first install in the constellation.
      - name: first_in_constellation_at_pt
        description: The timestamp of the Shop's first install in the constellation in PT.
      - name: constellation_cohort_week
        description: The week of the Shop's first install in the constellation.

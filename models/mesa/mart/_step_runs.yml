version: 2
models:
  - name: step_runs
    description: "Individual mesa workflow step executions."

    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 10000
    columns:
      - name: step_run_id
        tests:
          - not_null
          - unique
      - name: workflow_run_id
        tests:
          - not_null
          - relationships:
              field: workflow_run_id
              to: ref('workflow_runs')
              # where: step_type='input'
      - name: workflow_id
        tests:
          - not_null
          - relationships:
              to: ref('workflows')
              field: workflow_id
      - name: shop_subdomain
        tests:
          - not_null
          - relationships:
              to: ref('shops')
              field: shop_subdomain
      - name: WORKFLOW_STEP_ID
        tests:
          - not_null
          - relationships:
              to: ref('workflow_steps')
              field: workflow_step_id
      - name: step_RUN_AT_UTC
        tests:
          - not_null
      - name: step_RUN_AT_PT
        tests:
          - not_null
      - name: step_RUN_ON_PT
        tests:
          - not_null
      - name: step_type
        tests:
          - not_null
      - name: RUN_STATUS
        tests:
          - not_null
      - name: PRIORITY
      - name: TRIES
      - name: UPDATED_AT
        tests:
          - not_null
      - name: WORKFLOW_STEP_NAME
        tests:
          - not_null
      - name: WORKFLOW_STEP_KEY
        tests:
          - not_null
      - name: SHOP_SUBDOMAIN
        tests:
          - not_null
          - relationships:
              to: ref('shops')
              field: shop_subdomain
      - name: POSITION_IN_WORKFLOW_RUN
      - name: IS_WORKFLOW_HARD_DELETED
      - name: INTEGRATION_NAME
      - name: WORKFLOW_NAME
      - name: INTEGRATION_KEY

version: 2
models:
  - name: shops
    description: "formatted, production-ready shops."
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 4000

    columns:
      - name: shop_subdomain
        tests:
          - not_null
          - unique
      - name: first_installed_at_pt
        tests:
          - not_null
      - name: currency
        tests:
          - not_null
      - name: workflows_successfully_run_count
        tests:
          - not_null
      - name: workflows_created_count
        tests:
          - not_null
      - name: workflows_enabled_count
        tests:
          - not_null

      - name: shopify_plan_name
      - name: install_status
      - name: status
      - name: referral
      - name: meta
      - name: timestamp
      - name: latest_installed_at_pt
      - name: billing_method_name
      - name: billing_overage_bucket_start_date_pt
      - name: billing_overage_bucket_end_date_pt
      - name: billing_overage_bypass_until
      - name: billing_overage_last_count
      - name: daily_plan_revenue
      - name: price_per_action
      - name: activation_date_pt
      - name: is_activated
      - name: templates_installed_count
      - name: balance_used
      - name: shopify_id
      - name: orders_current_count
      - name: plan_price
      - name: plan_used
      - name: percent_complete
      - name: billing_on_pt
      - name: plan_name
      - name: percent_used
      - name: overlimit_date_pt
      - name: balance_remaining
      - name: orders_initial_count
      - name: start_date_pt
      - name: end_date_pt
      - name: revenue_initial_total
      - name: created_at_pt
      - name: trial_ends_pt
      - name: chargebee_id
      - name: billing_updated_at_pt
      - name: plan_type
      - name: days_complete
      - name: plan_id
      - name: revenue_current_total
      - name: plan_interval
      - name: trial_days
      - name: is_builder_wizard_completed
      - name: hotjar_url
      - name: backdoor_url
      - name: minutes_using_app
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.7
              config:
                where: "first_installed_at_pt > '2020-12-18'"
      - name: workflow_runs_count
        tests:
          - not_null
      - name: last_seen_in_app_at_pt
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.7
      - name: workflow_run_success_count
        tests:
          - not_null
      - name: minutes_until_uninstall
      - name: first_seen_in_app_at_pt
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.7
      - name: workflow_runs_rolling_thirty_day_count
        tests:
          - not_null
      - name: days_to_activation
        tests:
          - dbt_utils.not_null_proportion:
              at_least: 0.1
      - name: WORKFLOW_RUNS_ROLLING_YEAR_COUNT
      - name: UNINSTALLED_APP_AT_PT
